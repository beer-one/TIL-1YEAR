# K8S API 접근 제어

사용자(개발자)와 쿠버네티스 파드 내 컨테이너 모두 쿠버네티스 API에 접근할 수 있다. 쿠버네티스 API는 쿠버네티스 자원을 조회하거나 조작할 수 있는데, 사용자마다의 접근 권한을 제어하는 것은 필수이다. (아무나 쿠버네티스의 모든 자원을 함부로 조작하는 것을 방지해야 한다.)

여기서는 쿠버네티스 API에 대한 인증/인가 정책과 같은 API 접근 제어 방식에 대해 알아볼 것이다.



## 전송 보안

일반적으로 쿠버네티스 API는 443포트에서 서비스한다. API 서버는 인증서를 제시하며 이 인증서는 서명되기 때문에 사용자 머신의 `$USER/.kube/config` 에 루트 인증서가 있어야 하며 시스템 기본 루트 인증서 대신 사용된다. 



## 인증

TLS가 설정되면 HTTP 요청이 인증단계로 넘어간다. 여기서 클러스터 생성 스크립트 또는 클러스터 관리자는 API서버가 하나 이상의 인증 모듈을 실행하도록 구성한다.

인증 모듈은 여러가지가 있으며 이 중 여러 개의 인증 모듈을 지정할 수 있고 하나의 인증 모듈이 성공할 때 까지 각 모듈을 순차적으로 시도한다. (적어도 하나의 인증이 완료되면 통과) 요청 인증이 실패되면 401을 반환한다.

* 클라이언트 인증서
* 암호 및 일반 토큰
* 부트스트랩 토큰
* JWT 토큰 (ServiceAccount)





## 인가

인증 단계가 완료되면 인가 단계를 거친다. 요청은 요청자의 `username`, 요청된 작업 및 해당 작업이 영향을 주는 오브젝트를 포함해야 한다. 요청된 작업을 수행할 수 있는 권한이 해당 사용자에게 있다면 요청이 인가된다.

쿠버네티스에서는 ABAC, RBAC, 웹훅 모드와 같은 여러가지 인가 모듈을 지원한다. 이 또한 마찬가지로 여러개를 구성할 수 있으며 하나의 인가가 승인되면 요청을 진행할 수 있게된다. 모든 인가가 실패되면 403을 반환한다.





