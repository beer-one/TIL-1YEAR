# Kubernetes

Kubernetes는 컨테이너화된 워크로드와 서비스를 관리하기 위한 이식할 수 있고 확장 가능한 오픈소스 플랫폼으로, 선언적 구성과 자동화를 모두 지원한다. Kubernetes는 컨테이너 기반 분산 시스템을 탄력적으로 실행하기 위한 프레임워크를 제공한다. 애플리케이션의 확장과 장애 조치를 처리하고, 배포 패턴 등 여러 가지를 제공한다.

* 서비스 디스커버리와 로드밸런싱
* 스토리지 오케스트레이션
* 자동화된 롤아웃과 롤백
* 자동화된 빈 패킹
* 자동화된 복구
* 시크릿과 Configuration 관리



그리고 K8s는 완전한 PaaS가 아니지만 PaaS가 일반적으로 제공하는 배포, 스케일링, 로드밸런싱과 같은 기능을 제공하고, 로깅, 모니터링 및 알람 솔루션을 통합할 수 있지만 이러한 솔루션들이 선택적이며, 추가 및 제거가 간단하다. 그래서 K8s는 플랫폼을 만드는 구성 요소를 제공하지만 필요한 경우 구성 요소 사용의 선택권과 유연셩을 지켜준다. K8s의 특징은 다음과 같다.

* 지원하는 애플리케이션의 유형을 제약하지 않는다. 애플리케이션이 컨테이너에서 구동될 수 있다면 K8s에서도 잘 동작할 것이다.
* 소스코드를 배포하지 않으며 애플리케이션을 빌드하지 않는다. CI/CD 워크플로우는 조직 문화와 기술적인 요구사항 및 취향에 따라 결정된다.
* 애플리케이션의 레벨의 서비스를 제공하지 않는다. DB, Kafka, Redis 등이 있으며 이는 K8s에서 직접 제공하지는 않지만 컨테이너로써 구동될 수 있다.
* 로깅, 모니터링 또는 노티 솔루션 등을 포함하지 않는다. 대신 메트릭을 수집하고 노출하는 메커니즘을 제공한다.
* 기본 설정 언어 / 시스템을 제공하거나 요구하지 않는다. 선언적 명세의 임의적인 형식을 목적으로 하는 선언적 API를 제공한다.
* 머신 설정, 유지보수, 관리, 자동복구 시스템을 제공하거나 채택하지 않는다.



## K8s 컴포넌트

K8s를 배포하면 클러스터를 얻는다. K8s 클러스터는 컨테이너화된 애플리케이션을 실행하는 노드들의 집합이며, 모든 클러스터는 최소 하나의 워커노드를 가진다.

워커 노드는 애플리케이션의 구성요소인 `파드` 를 호스팅한다. `컨트롤 플레인` 은 워커노드와 클러스터 내 파드를 관리한다. 일반적으로 프로덕션 환경에서는 컨트롤 플레인이 여러 컴퓨터에 걸쳐 실행되고, 클러스터는 일반적으로 여러 노드를 실행하므로 내결함성과 고가용성이 제공된다.

![쿠버네티스의 컴포넌트](https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg)



### 컨트롤 플레인 컴포넌트

컨트롤 플레인 컴포넌트는 클러스터에 관한 전반적인 결정을 수행하고 클러스터 이벤트를 감지하고 반응한다. 컨트롤 플레인 컴포넌트의 종류는 아래와 같다.

* kube-apiserver: K8s API를 노출하는 컨트롤 플레인 컴포넌트
* etcd: 모든 클러스터 데이터를 담는 key-value 기반 저장소
* kube-scheduler: 노드가 배정되지 않은 새로 생성된 파드를 감지하고 실행할 노드를 선택하는 컨트롤 플레인 컴포넌트
* kube-controller-manager: 컨트롤러 프로세스를 실행하는 컨트롤 플레인 컴포넌트
* cloud-controller-manager: 클라우드별 컨트롤 로직을 포함하는 컨트롤 플레인 컴포넌트





## 노드 컴포넌트

노드 컴포넌트는 동작 중인 파드를 유지시키고 K8s 런타임 환경을 제공하며, 모든 노드 상에서 동작한다. 노드 컴포넌트의 종류로는 아래와 같다.

* kubelet: 클러스터의 각 노드에서 실행되는 에이전트. kubelet은 파드에서 컨테이너가 확실하게 동작하도록 관리한다.
* kube-proxy: 클러스터의 각 노드에서 실행되는 네트워크 프록시로 K8s 서비스 개념의 구현부이다.
* 컨테이너 런타임: 컨테이너 실행을 담당하는 소프트웨어 (Docker, Containerd, CRI-O, K8s CRI...)





## 애드온

애드온은 K8s 리소스를 이용하여 클러스터 기능을 구현한다. 이들은 클러스터 단위의 기능을 제공하기 때문에 애드온에 대한 네임스페이스 리소스는 `kube-system` 네임스페이스에 속한다. 애드온의 종류로는 아래와 같다.

* DNS: K8s 서비스를 위해 DNS 레코드를 제공해주는 DNS 서버이다. K8s에 의해 구동되는 컨테이너는 DNS 검색에서 이 DNS 서버를 자동으로 포함한다.
* 웹 UI (Dashboard): 대시보드는 K8s 클러스터를 위한 범용의 웹 기반 UI이다.
* 컨테이너 리소스 모니터링: 중앙 데이터베이스 내의 컨테이너들에 대한 포괄적은 시계열 메트릭 들을 기록하고 그 데이터를 열람하기 위한 UI를 제공해준다.
* 클러스터-레벨 로깅: 검색/열람 인터페이스와 함께 중앙 로그 저장소에 컨테이너 로그를 저장하는 책임을 가진다.

















